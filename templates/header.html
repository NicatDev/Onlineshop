{% load static %}
{% load i18n %}
<div class="sidebar-menu" id="sidebar-menu">
    <button class="sidebar-menu-close">X</button>
    <div class="sidebar-inner">
        <div class="sidebar-logo">
            <img src="{% static 'assets/1.png' %}" alt="">
        </div>
        <div class="sidemenu-text">
            <p>Viktoria's sirri</p>
        </div>
        <div class="sidebar-contact">
            <h4>{% trans 'Əlaqə' %}</h4>
            <ul>
                <li><i class="fa fa-map-marker"></i>{% trans 'Bakı şəh. 15-17 Xaqani Küçəsi' %}</li>
                <li><i class="fa fa-envelope"></i>{% trans 'viktoriassirri@gmail.com' %}</li>
                <li><i class="fa fa-phone"></i>(+994) 50 640-85-35 </li>
            </ul>
        </div>
                 
                    
      
    </div>
</div>
<div class="body-overlay" id="body-overlay"></div>
<div class="search-popup" id="search-popup">
    <form id="search-form" action="{% url 'shop' %}" class="search-form" method="get">
        <div class="form-group">
            <input type="text" id="search-input" class="form-control" placeholder="{% trans 'Axtar...' %}">
        </div>
        <button type="submit" class="submit-btn"><i class="fa fa-search"></i></button>
    </form>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<div class="stoon-navbar">
    <div class="header-top d-none d-sm-block">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-lg-4 col-8">
                    <div class="contact">
                        <a href="tel:+994506408535"><i class="icon-call-header"></i> (+994) 50 640-85-35 </a>
                        <a href="#"><i class="icon-email-subscribe"></i>viktoriassirri@gmail.com</a>
                    </div>
                </div>
                <div class="col-lg-4 d-none d-lg-block">
                    <div class="shipping text-center">
                        <p>{% trans 'Ödənişsiz çatdırılma ' %} </p>
                    </div>
                </div>
                <div class="col-lg-4 col-4">
           
                </div>
            </div>
        </div>
    </div>
    <nav class="navbar navbar-area navbar-expand-lg nav-style-01">
        <div class="container-fluid nav-container">
            <div class="row">
                <div class="col-lg-3 col-3 order-1 align-self-center">
                    <div class="logo">
                        <a href="{% url 'home' %}"><img style="max-height:50px !important" src="{% static 'assets/1.png' %}" alt=""></a>
                        
                    </div>
                
                </div>
                <div class="col-lg-6 order-3 order-lg-2">
                    <div class="collapse navbar-collapse" id="shop-menu">
                        <ul class="navbar-nav menu-open">
                    
                            <li><a href="{% url 'home' %}">{% trans 'Ana Səhifə' %}</a></li>
                            <li><a href="{% url 'about' %}">{% trans 'Haqqımızda' %}</a></li>
                            <li><a href="{% url 'shop' %}">{% trans 'Məhsullar' %}</a></li>
                            <li><a href="{% url 'blogs' %}">{% trans 'Bloqlar' %}</a></li>
                            <li><a href="{% url 'contact' %}">{% trans 'Əlaqə' %}</a></li>
          
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 col-9 justify-content-end d-flex order-2 order-lg-3">
                    <div class="nav-right-part">
                        <ul>
                           		
                           
                                {% get_current_language as LANGUAGE_CODE %}
                                                    
                                {% get_available_languages as LANGUAGES %}
                                <li class="dropdown" >
                                    <input type="checkbox" id="languageDropdown" class="dropdown-input">
                                    <label   for="languageDropdown" style="text-transform: uppercase;margin-bottom:0px;margin-top:3px;" class="dropbtn">{{LANGUAGE_CODE}} <span style="text-align:center;font-size:12px"> ▼</span></label>
                                    <ul id="myDropdown" class="dropdown-content">
                                        {% for lang_code, lang_name in LANGUAGES %}
                                            <li style="margin:0px;padding:0px"><a style="display:inline-block;padding:8px 14px;" href="{% url 'set_language' lang_code=lang_code url=request.get_full_path %}">{{ lang_name }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </li>
                            
                                <style>
                                    @media only screen and (min-width: 990px) and (max-width: 1112px) {
                                    .search-icon-li{
                                        display:none !important;
                                    }
                                }
                                    .dropdown-input {
                                        display: none;
                                    }
                                
                                    .dropdown-content {
                                        display: none !important;
                                        position: absolute;
                                        background-color: #f9f9f9;
                                        min-width: 15px;
                                        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                                        z-index: 1;
                                        list-style-type: none;
                                        padding: 0;
                                    }
                                
                                    .dropdown-content li {
                                        padding: 8px 12px;
                                    }
                                
                                    .dropdown-content li:hover {
                                        background-color: #f1f1f1;
                                    }
                                
                                    .dropdown:hover .dropdown-content {
                                        display: block !important;
                                    }
                                
                                    .dropbtn {
                                        cursor: pointer;
                                    }
                                </style>
                            
												
                            <li class="search-icon-li">
                                <a href="#" id="search"><i class="icon-search"></i></a>
                            </li>
                            <li>
                                <a href="{% url 'wish' %}"><i class="icon-heart"></i>{% if request.user.is_authenticated %} <span class="badge wishbadge">{{request.user.wishproducts.all.count}}  </span>{% endif %}</a>
                            </li>
                            <li class="has-dropdown">
                                <a ><i class="icon-add-to-cat"></i><span class="badge basketbadge">{{ orderitems.leng }}</span></a>
                                <ul id="orderitems">
                                    {% for item in orderitems.orderitems %}
                                    <li>
                                    <div class="d-flex">
                                        <div  class="thumb">
                                            <img  src="{{item.product.get_main_image.url}}" alt="{{item.product.name}}">
                                        </div>
                                        <div  class="content">
                                            <h6 style="margin-bottom:0px"  class="title"><a href="{% url 'shopSingle' item.product.slug %}" >{{item.product.name}} </a></h6>
                                            <div style="display:flex;font-size:12px;font-weight:600; gap:4px;margin-bottom:5px">
                                                 <span>Rəng: {{item.color.name}}</span> , <span>Bədən: {{item.size.name}} </span> 
                                            
                                            </div>
                                            <span class="price">{{item.product.get_discount_price}} azn</span>
                                        </div>
                                        <div class="action" >
                                            <input readonly type="text" value="{{item.quantity}}" >
                                           
                                            <a style="cursor:pointer" onclick="delete_order_item('{{ item.id }}','{% url 'delete_order_item' %}','{{ csrf_token }}')" id="{{item.product.id}}" class="remove"><i  class="fa-solid fa-trash-can"></i></a>
                                        </div>
                                    </div>
                                </li>
                                    {% endfor %}
                                    <li >
                                    <div class="d-flex">
                                        <a href="{% url 'shopping' %}" style="width:100%;padding:10px 50px;color:white;" class="btn btn-contact" style="color:white">{% trans 'Səbətə bax' %}</a>
                                    </div>
                                </li>
                                </ul>
                            </li>
                            <li>
                                <a ><i class="icon-user"></i></a>
                                <ul class="user-dropdown">

                                    {% if request.user.is_authenticated %}

                                    <li><a >{{ request.user }}</a></li>
                                    <li><a href="{% url 'shopping' %}"><i class="icon-user"></i>{% trans 'Sifarişlərim' %}</a></li>
                                    <li><a href="{% url 'logout' %}"><i class="fa fa-briefcase"></i>{% trans 'Çıxış et' %}</a></li>
                 
                                    {% else %}

                                    <li><a ></a></li>
                                    <li><a href="{% url 'login' %}"><i class="icon-user"></i>{% trans 'Daxil ol' %}</a></li>
                                    <li><a href="{% url 'register' %}"><i class="fa fa-briefcase"></i>{% trans 'Qeydiyyat' %}</a></li>

                                    {% endif %}

                                </ul>
                            </li>
                            <li class="d-none d-lg-block">
                                <a href="#" id="navigation-button"><i class="icon-bar-icon"></i></a>
                            </li>
                        </ul>
                    </div>
                    <div class="responsive-mobile-menu">
                        <div class="menu toggle-btn d-block d-lg-none" data-toggle="collapse" data-target="#shop-menu" aria-expanded="false" role="button">
                            <div class="icon-left"></div>
                            <div class="icon-right"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</div>

<script src="{% static 'assets/js/functions.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
    
        searchForm.addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent default form submission
    
            const inputValue = searchInput.value.trim();
    
            if (inputValue !== '') {
                const url = `{% url 'shop' %}?search=${encodeURIComponent(inputValue)}`;
                window.location.href = url;
            }
        });
    });
    </script>
    {% if not request.user.is_authenticated %}
    <script>
        function GetLocalItem(){
            if (localStorage.getItem('items').length==0){
                var ul = document.getElementById("orderitems");
                        ul.innerHTML = "";
                return;
            }
        var localitems = JSON.parse(localStorage.getItem('items'))
        var sum = localitems.reduce(function(total, current) {
            return total + parseInt(current.quantity);
        }, 0);
        var ul = document.getElementById("orderitems");
                        ul.innerHTML = "";
                        
                        localitems.forEach(function(newItemData) {
                            var li = document.createElement("li");
           
                            li.innerHTML = `
                                <div class="d-flex">
                                    <div class="thumb">
                                        <img src="${newItemData.product.image.url}" alt="${newItemData.product.name}">
                                    </div>
                                    <div class="content">
                                        <h6 class="title"><a href="${newItemData.product.product_url}">${newItemData.product.name}</a></h6>
                                        <span class="price">${newItemData.product.price}</span>
                                    </div>
                                    <div class="action">
                                        <input type="number" value="${newItemData.quantity}">
                                        <a style="cursor:pointer" onclick="deleteFromBasket(${newItemData.product.id},${newItemData.color.id},${newItemData.size.id})" id="${newItemData.product.id}" ><i class="fa-solid fa-trash-can"></i></a>
                                    </div>
                                </div>
                            `;
                            ul.appendChild(li);
                        });
                        var li = document.createElement('li')
                        li.innerHTML = `
                            <div class="d-flex">
                                <a href="{% url 'shopping' %}" style="width:100%;padding:10px 50px;color:white;" class="btn btn-contact" style="color:white">Səbətə bax</a>
                            </div>`
                      
                            ul.appendChild(li);
                            $('.basketbadge').text(sum);
                        }
                        GetLocalItem()
                            
    </script>
    {% endif %}
<script>
    function deleteFromBasket(product,color,size){
        
            var items = JSON.parse(localStorage.getItem('items'));
         

            var indexToRemove = items.findIndex(function(item) {
                   return item.product.id == product && 
                    item.color.id == color && 
                    item.size.id == size;
            });
        
            if (indexToRemove !== -1) {
                items.splice(indexToRemove, 1); 
            }

            var updatedItemsJson = JSON.stringify(items);
            localStorage.setItem('items', updatedItemsJson);
            GetLocalItem();
            var fullURL = window.location.href;
            if (fullURL.includes("auth/shopping")) {
                getShoppingCartNotAuth();
            }
            
    }
</script>

<script>
	function updateLanguageBasedOnCookie() {
		var langCookie = document.cookie.replace(/(?:(?:^|.*;\s*)django_language\s*=\s*([^;]*).*$)|^.*$/, "$1");
		if (langCookie) {
			var urlParts = window.location.href.split('/');
			urlParts.splice(3, 1, langCookie); 
			var newURL = urlParts.join('/');
			if (window.location.href !== newURL) {
				document.cookie = "django_language=" + langCookie + "; path=/";
				window.location.href = newURL
			}
		}
	}
	
	// Sayfa yüklendiğinde çalıştır
	window.onload = function() {
		updateLanguageBasedOnCookie();
	};
	
</script>
<style>
    .remove i{
        color:black !important; font-size:20px; padding-top:5px
    }
    .action{
        text-align:center;display: flex;
                    flex-direction: column;
                    justify-content: space-between;
    }
    .content{
        text-align:left;display: flex;
                    flex-direction: column;
                    justify-content: space-between;width:65%
    }
    #orderitems .thumb{
        width:25%
    }
</style>
